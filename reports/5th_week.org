#+TITLE: Report for : Un intergiciel d’une base de données NewSQL qui considère la localité de l’application cliente -- 4th week --
#+AUTHOR: Marie Delavergne

* Monday 12 February [2018-02-12 lun.]

- Trying the commented version for MariaDB as soon as I arrived
  + Reminder: we commented the volume created for the db because of [[https://stackoverflow.com/questions/34198735/could-not-open-mysql-plugin-table-some-plugins-may-be-not-loaded][this thread]]
  + MariaDB working after ~destroy~ and ~prepare~ BUT sysbench logs say:
    #+BEGIN_EXAMPLE
root@grisou-47:~# docker logs sysbench
sysbench 1.0.7 (using bundled LuaJIT 2.1.0-beta2)

Running the test with following options:
Number of threads: 1
Initializing random number generator from current time


Initializing worker threads...

FATAL: unable to connect to MySQL server on host '172.16.72.47', port 3306, aborting...
FATAL: error 2013: Lost connection to MySQL server at 'reading initial communication packet', system error: 0
FATAL: `thread_init' function failed: /usr/share/sysbench/oltp_common.lua:347: connection creation failed
FATAL: Thread initialization failed!
Error in my_thread_global_end(): 1 threads didn't exit
    #+END_EXAMPLE
  + Trying to find the problem:
    #+BEGIN_EXAMPLE
root@grisou-47:~# docker run --name=sysbench2 -d severalnines/sysbench sysbench --db-driver=mysql --table-size=100000 --mysql-host=172.16.72.47 --mysql-port=3306 --mysql-user=sbtest --mysql-password=sbtest oltp_read_write prepare
1065d716e5850fc3eb7c7ce97bc3d95c4cb200d5453c7dc8aec230518542ff0a
root@grisou-47:~# docker logs sysbench2
sysbench 1.0.7 (using bundled LuaJIT 2.1.0-beta2)

Creating table 'sbtest1'...
Inserting 100000 records into 'sbtest1'
Creating a secondary index on 'sbtest1'...
    #+END_EXAMPLE
  + And then:
#+BEGIN_EXAMPLE
root@grisou-47:~# docker run --name=sysbench3 -d severalnines/sysbench sysbench --db-driver=mysql --table-size=100000 --mysql-host=172.16.72.47 --mysql-port=3306 --mysql-user=sbtest --mysql-password=sbtest oltp_read_write run
230ff40920ef1cf34295a98333263daf3a5baf04086cb49c23701df443af7454
root@grisou-47:~# docker logs sysbench3
sysbench 1.0.7 (using bundled LuaJIT 2.1.0-beta2)

Running the test with following options:
Number of threads: 1
Initializing random number generator from current time


Initializing worker threads...

Threads started!

SQL statistics:
    queries performed:
        read:                            4256
        write:                           1216
        other:                           608
        total:                           6080
    transactions:                        304    (30.36 per sec.)
    queries:                             6080   (607.30 per sec.)
    ignored errors:                      0      (0.00 per sec.)
    reconnects:                          0      (0.00 per sec.)

General statistics:
    total time:                          10.0095s
    total number of events:              304

Latency (ms):
         min:                                 22.82
         avg:                                 32.92
         max:                                142.99
         95th percentile:                     45.79
         sum:                              10007.83

Threads fairness:
    events (avg/stddev):           304.0000/0.00
    execution time (avg/stddev):   10.0078/0.00
#+END_EXAMPLE
  + I had to make another container because sysbench2 was already not responding, but this works and if it was a matter of creating another container, I would have the same error (container not running)

- I try a clean deploy to check if at least works the first time or if I broke everything
  + First deploy is ok
    #+BEGIN_EXAMPLE
  root@grisou-18:~# docker logs sysbench
sysbench 1.0.7 (using bundled LuaJIT 2.1.0-beta2)

Running the test with following options:
Number of threads: 1
Initializing random number generator from current time


Initializing worker threads...

Threads started!

SQL statistics:
    queries performed:
        read:                            4438
        write:                           1268
        other:                           634
        total:                           6340
    transactions:                        317    (31.58 per sec.)
    queries:                             6340   (631.70 per sec.)
    ignored errors:                      0      (0.00 per sec.)
    reconnects:                          0      (0.00 per sec.)

General statistics:
    total time:                          10.0344s
    total number of events:              317

Latency (ms):
         min:                                 24.31
         avg:                                 31.65
         max:                                 74.07
         95th percentile:                     35.59
         sum:                              10032.58

Threads fairness:
    events (avg/stddev):           317.0000/0.00
    execution time (avg/stddev):   10.0326/0.00
    #+END_EXAMPLE
  + second deploy, not that much
    #+BEGIN_EXAMPLE
    root@grisou-18:~# docker logs sysbench
sysbench 1.0.7 (using bundled LuaJIT 2.1.0-beta2)

Running the test with following options:
Number of threads: 1
Initializing random number generator from current time


Initializing worker threads...

FATAL: unable to connect to MySQL server on host '172.16.72.18', port 3306, aborting...
FATAL: error 2013: Lost connection to MySQL server at 'reading initial communication packet', system error: 0
FATAL: `thread_init' function failed: /usr/share/sysbench/oltp_common.lua:347: connection creation failed
FATAL: Thread initialization failed!
Error in my_thread_global_end(): 1 threads didn't exit
    #+END_EXAMPLE
  + tried with a cleanup, didn't work either, and in any case I should have find a way to destroy sysbench before mariadb
